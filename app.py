import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from pathlib import Path
import matplotlib
import platform

# í•œê¸€ í°íŠ¸ ì„¤ì •
if platform.system() == 'Darwin':  # macOS
    matplotlib.rcParams['font.family'] = 'AppleGothic'
elif platform.system() == 'Windows':  # Windows
    matplotlib.rcParams['font.family'] = 'Malgun Gothic'
else:
    matplotlib.rcParams['font.family'] = 'NanumGothic'
    
matplotlib.rcParams['axes.unicode_minus'] = False  # ë§ˆì´ë„ˆìŠ¤ ë¶€í˜¸ ê¹¨ì§ ë°©ì§€

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ì»¤í”¼ìˆ ë§¤ì¶œ ë¶„ì„ ëŒ€ì‹œë³´ë“œ",
    page_icon="â˜•",
    layout="wide"
)

# ë°ì´í„° ë¡œë“œ
@st.cache_data
def load_data():
    data_path = Path("data/raw/coffee_shop_revenue.csv")
    if data_path.exists():
        df = pd.read_csv(data_path)
        return df
    else:
        st.error("ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. data/raw/coffee_shop_revenue.csv íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.")
        return None

# ë©”ì¸ í•¨ìˆ˜
def main():
    st.title("â˜• ì»¤í”¼ìˆ ë§¤ì¶œ ë¶„ì„ ëŒ€ì‹œë³´ë“œ")
    
    # ë°ì´í„° ë¡œë“œ
    df = load_data()
    if df is None:
        return
    
    # ì‚¬ì´ë“œë°”
    st.sidebar.header("ë¶„ì„ ì˜µì…˜")
    analysis_type = st.sidebar.selectbox(
        "ë¶„ì„ ìœ í˜• ì„ íƒ",
        ["ê¸°ë³¸ í†µê³„", "ìƒê´€ê´€ê³„ ë¶„ì„", "ì‹œê³„ì—´ ë¶„ì„", "íŠ¹ì„± ë¶„ì„"]
    )
    
    # ê¸°ë³¸ í†µê³„
    if analysis_type == "ê¸°ë³¸ í†µê³„":
        st.header("ê¸°ë³¸ í†µê³„ ë¶„ì„")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.subheader("ë§¤ì¶œ í†µê³„")
            st.write(df['Daily_Revenue'].describe())
            
            # ë§¤ì¶œ ë¶„í¬
            fig, ax = plt.subplots(figsize=(10, 6))
            sns.histplot(data=df, x='Daily_Revenue', bins=30)
            plt.title('ì¼ì¼ ë§¤ì¶œ ë¶„í¬')
            st.pyplot(fig)
        
        with col2:
            st.subheader("ì£¼ìš” ì§€í‘œ")
            metrics = {
                'í‰ê·  ë§¤ì¶œ': df['Daily_Revenue'].mean(),
                'ìµœëŒ€ ë§¤ì¶œ': df['Daily_Revenue'].max(),
                'ìµœì†Œ ë§¤ì¶œ': df['Daily_Revenue'].min(),
                'ë§¤ì¶œ í‘œì¤€í¸ì°¨': df['Daily_Revenue'].std()
            }
            for metric, value in metrics.items():
                st.metric(metric, f"${value:,.2f}")
        
        # ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
        st.markdown("---")
        st.subheader("ğŸ“Š ê¸°ë³¸ í†µê³„ ë¶„ì„ ì¸ì‚¬ì´íŠ¸")
        
        # ì¸ì‚¬ì´íŠ¸ ë‚´ìš©
        st.markdown("""
        ### ì£¼ìš” ì¸ì‚¬ì´íŠ¸:
        1. **í‰ê·  ë§¤ì¶œ**ì€ $1,917.33ë¡œ, ì¼ë°˜ì ì¸ ì»¤í”¼ìˆ í‰ê·  ë§¤ì¶œê³¼ ë¹„êµí•˜ì—¬ ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.
        2. **ë§¤ì¶œ ë³€ë™ì„±**ì´ í¬ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤ (í‘œì¤€í¸ì°¨: $976.20). ì´ëŠ” ìš”ì¼ë³„, ê³„ì ˆë³„ ë³€ë™ì´ í¬ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
        3. **ìµœì†Œ ë§¤ì¶œ**ì´ ìŒìˆ˜(-$58.95)ì¸ ê²½ìš°ê°€ ìˆì–´, ì¼ë¶€ í™˜ë¶ˆì´ë‚˜ ì¡°ì • ì‚¬í•­ì´ ìˆì—ˆë˜ ê²ƒìœ¼ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.
        4. **ìµœëŒ€ ë§¤ì¶œ**($5,114.60)ê³¼ ìµœì†Œ ë§¤ì¶œ ê°„ì˜ ì°¨ì´ê°€ í¬ê²Œ ë‚˜íƒ€ë‚˜ íŠ¹ë³„ ì´ë²¤íŠ¸ë‚˜ ì„±ìˆ˜ê¸° íš¨ê³¼ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        
        ### ê°œì„  ì œì•ˆ:
        - ë§¤ì¶œ ë³€ë™ì„±ì„ ì¤„ì´ê¸° ìœ„í•œ ì „ëµ ìˆ˜ë¦½ì´ í•„ìš”í•©ë‹ˆë‹¤.
        - ë§¤ì¶œì´ ë‚®ì€ ë‚ ì˜ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ í”„ë¡œëª¨ì…˜ ì „ëµì„ êµ¬ìƒí•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ìµœëŒ€ ë§¤ì¶œì„ ê¸°ë¡í•œ ë‚ ì˜ ìš”ì¸ì„ ë¶„ì„í•˜ì—¬ ìœ ì‚¬ ì „ëµì„ ìˆ˜ë¦½í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.
        """)
    
    # ìƒê´€ê´€ê³„ ë¶„ì„
    elif analysis_type == "ìƒê´€ê´€ê³„ ë¶„ì„":
        st.header("ìƒê´€ê´€ê³„ ë¶„ì„")
        
        # ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ
        fig, ax = plt.subplots(figsize=(12, 8))
        sns.heatmap(df.corr(), annot=True, cmap='coolwarm', center=0)
        plt.title('ë³€ìˆ˜ ê°„ ìƒê´€ê´€ê³„')
        st.pyplot(fig)
        
        # ë§¤ì¶œê³¼ì˜ ìƒê´€ê´€ê³„
        st.subheader("ë§¤ì¶œê³¼ì˜ ìƒê´€ê´€ê³„")
        revenue_corr = df.corr()['Daily_Revenue'].sort_values(ascending=False)
        st.write(revenue_corr)
        
        # ì£¼ìš” ë³€ìˆ˜ì™€ ë§¤ì¶œì˜ ê´€ê³„
        st.subheader("ì£¼ìš” ë³€ìˆ˜ì™€ ë§¤ì¶œì˜ ê´€ê³„")
        selected_feature = st.selectbox(
            "ë³€ìˆ˜ ì„ íƒ",
            ['Number_of_Customers_Per_Day', 'Average_Order_Value', 
             'Marketing_Spend_Per_Day', 'Operating_Hours_Per_Day']
        )
        
        fig, ax = plt.subplots(figsize=(10, 6))
        sns.scatterplot(data=df, x=selected_feature, y='Daily_Revenue')
        plt.title(f'{selected_feature}ì™€ ë§¤ì¶œì˜ ê´€ê³„')
        st.pyplot(fig)
        
        # ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
        st.markdown("---")
        st.subheader("ğŸ“Š ìƒê´€ê´€ê³„ ë¶„ì„ ì¸ì‚¬ì´íŠ¸")
        
        # ì¸ì‚¬ì´íŠ¸ ë‚´ìš©
        st.markdown("""
        ### ì£¼ìš” ì¸ì‚¬ì´íŠ¸:
        1. **ê³ ê° ìˆ˜**(0.736)ì™€ **í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡**(0.536)ì´ ë§¤ì¶œê³¼ ê°€ì¥ ê°•í•œ ì–‘ì˜ ìƒê´€ê´€ê³„ë¥¼ ë³´ì…ë‹ˆë‹¤.
        2. **ë§ˆì¼€íŒ… ì§€ì¶œ**(0.255)ì€ ë§¤ì¶œê³¼ ì•½í•œ ì–‘ì˜ ìƒê´€ê´€ê³„ë¥¼ ë³´ì…ë‹ˆë‹¤.
        3. **ì˜ì—…ì‹œê°„**(-0.005), **ì§ì› ìˆ˜**(0.003), **ìœ„ì¹˜ ìœ ë™ì¸êµ¬**(0.013)ëŠ” ë§¤ì¶œê³¼ ê±°ì˜ ìƒê´€ê´€ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.
        
        ### ê°œì„  ì œì•ˆ:
        - **ê³ ê° ìˆ˜ ì¦ê°€ ì „ëµ**ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ê°€ì¥ íš¨ê³¼ì ì…ë‹ˆë‹¤:
          * ê³ ê° ìœ ì¹˜ í”„ë¡œê·¸ë¨ ê°•í™”
          * ì¶©ì„±ë„ í”„ë¡œê·¸ë¨ ë„ì…
          * ì¬ë°©ë¬¸ìœ¨ í–¥ìƒ ì „ëµ ìˆ˜ë¦½
        - **í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ ì¦ê°€ ì „ëµ**ë„ íš¨ê³¼ì ì…ë‹ˆë‹¤:
          * ë©”ë‰´ êµ¬ì„± ìµœì í™”
          * ì„¸íŠ¸ ë©”ë‰´ ë˜ëŠ” ì—…ì…€ë§ ì „ëµ ë„ì…
          * ê³ ê°€ ë©”ë‰´ ì•„ì´í…œ ì¶”ê°€ ê²€í† 
        - **ë§ˆì¼€íŒ… íš¨ìœ¨ì„± ê°œì„ **ì´ í•„ìš”í•©ë‹ˆë‹¤:
          * í˜„ì¬ ë§ˆì¼€íŒ… ì§€ì¶œì´ ë§¤ì¶œì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì œí•œì ì„
          * íƒ€ê²Ÿ ë§ˆì¼€íŒ… ë° ROI ë¶„ì„ ê°•í™” í•„ìš”
        """)
    
    # ì‹œê³„ì—´ ë¶„ì„
    elif analysis_type == "ì‹œê³„ì—´ ë¶„ì„":
        st.header("ì‹œê³„ì—´ ë¶„ì„")
        
        # ë§¤ì¶œ ì¶”ì´
        fig, ax = plt.subplots(figsize=(15, 6))
        plt.plot(df.index, df['Daily_Revenue'])
        plt.title('ì¼ë³„ ë§¤ì¶œ ì¶”ì´')
        plt.xlabel('ì¼ì')
        plt.ylabel('ë§¤ì¶œ')
        st.pyplot(fig)
        
        # ì´ë™í‰ê· 
        window = st.slider('ì´ë™í‰ê·  ê¸°ê°„', 7, 30, 7)
        df['MA'] = df['Daily_Revenue'].rolling(window=window).mean()
        
        fig, ax = plt.subplots(figsize=(15, 6))
        plt.plot(df.index, df['Daily_Revenue'], label='ì¼ë³„ ë§¤ì¶œ')
        plt.plot(df.index, df['MA'], label=f'{window}ì¼ ì´ë™í‰ê· ')
        plt.title('ë§¤ì¶œ ì¶”ì´ì™€ ì´ë™í‰ê· ')
        plt.legend()
        st.pyplot(fig)
        
        # ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
        st.markdown("---")
        st.subheader("ğŸ“Š ì‹œê³„ì—´ ë¶„ì„ ì¸ì‚¬ì´íŠ¸")
        
        # ì¸ì‚¬ì´íŠ¸ ë‚´ìš©
        st.markdown("""
        ### ì£¼ìš” ì¸ì‚¬ì´íŠ¸:
        1. ë§¤ì¶œ ë°ì´í„°ëŠ” **ì£¼ê¸°ì ì¸ íŒ¨í„´**ì„ ë³´ì´ë©°, ì´ëŠ” ìš”ì¼ë³„ íŒ¨í„´ì´ ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤.
        2. ì´ë™í‰ê· ì„ ì„ í†µí•´ ì „ë°˜ì ì¸ **ì¶”ì„¸**ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¹ì • ê¸°ê°„ì— ë§¤ì¶œì´ ì¦ê°€ ë˜ëŠ” ê°ì†Œí•˜ëŠ” íŒ¨í„´ì´ ìˆìŠµë‹ˆë‹¤.
        3. ë‹¨ê¸°ì ì¸ **ì´ìƒì¹˜**(íŠ¹ë³„íˆ ë†’ê±°ë‚˜ ë‚®ì€ ë§¤ì¶œ)ê°€ ê´€ì°°ë˜ë©°, íŠ¹ë³„ ì´ë²¤íŠ¸ë‚˜ ì™¸ë¶€ ìš”ì¸ì˜ ì˜í–¥ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        
        ### ê°œì„  ì œì•ˆ:
        - **ìš”ì¼ë³„ íŒ¨í„´**ì„ ë¶„ì„í•˜ì—¬ ìš”ì¼ë³„ ë§ì¶¤í˜• í”„ë¡œëª¨ì…˜ ì „ëµì„ êµ¬ìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ë§¤ì¶œì´ ë‚®ì€ ê¸°ê°„ì— **íŠ¹ë³„ í”„ë¡œëª¨ì…˜**ì„ ê³„íší•˜ì—¬ ë§¤ì¶œ ì•ˆì •í™”ë¥¼ ë„ëª¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ì¥ê¸°ì ì¸ **ê³„ì ˆì„±**ì„ íŒŒì•…í•˜ì—¬ ê³„ì ˆì— ë§ëŠ” ë©”ë‰´ êµ¬ì„± ë° ë§ˆì¼€íŒ… ì „ëµì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ë†’ì€ ë§¤ì¶œì„ ê¸°ë¡í•œ ë‚ ì˜ **ì„±ê³µ ìš”ì¸**ì„ ë¶„ì„í•˜ì—¬ í–¥í›„ ì „ëµì— ë°˜ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
    
    # íŠ¹ì„± ë¶„ì„
    elif analysis_type == "íŠ¹ì„± ë¶„ì„":
        st.header("íŠ¹ì„± ë¶„ì„")
        
        col1, col2 = st.columns(2)
        
        with col1:
            st.subheader("ê³ ê° ìˆ˜ ë¶„ì„")
            fig, ax = plt.subplots(figsize=(10, 6))
            sns.histplot(data=df, x='Number_of_Customers_Per_Day', bins=30)
            plt.title('ì¼ì¼ ê³ ê° ìˆ˜ ë¶„í¬')
            st.pyplot(fig)
            
            st.write("ê³ ê° ìˆ˜ í†µê³„:")
            st.write(df['Number_of_Customers_Per_Day'].describe())
        
        with col2:
            st.subheader("í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ ë¶„ì„")
            fig, ax = plt.subplots(figsize=(10, 6))
            sns.histplot(data=df, x='Average_Order_Value', bins=30)
            plt.title('í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ ë¶„í¬')
            st.pyplot(fig)
            
            st.write("í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ í†µê³„:")
            st.write(df['Average_Order_Value'].describe())
        
        # ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
        st.markdown("---")
        st.subheader("ğŸ“Š íŠ¹ì„± ë¶„ì„ ì¸ì‚¬ì´íŠ¸")
        
        # ì¸ì‚¬ì´íŠ¸ ë‚´ìš©
        st.markdown("""
        ### ì£¼ìš” ì¸ì‚¬ì´íŠ¸:
        1. **ê³ ê° ìˆ˜ ë¶„í¬**ëŠ” ì •ê·œ ë¶„í¬ì— ê°€ê¹Œìš°ë©°, í‰ê· ì ìœ¼ë¡œ í•˜ë£¨ì— ì•½ 400ëª…ì˜ ê³ ê°ì´ ë°©ë¬¸í•©ë‹ˆë‹¤.
        2. **í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡**ì€ ì•½ $8.5 ì •ë„ë¡œ, ì¼ë°˜ ì»¤í”¼ ê°€ê²©ëŒ€ë³´ë‹¤ ë†’ì€ í¸ìœ¼ë¡œ í”„ë¦¬ë¯¸ì—„ ì»¤í”¼ ë° í‘¸ë“œ ì•„ì´í…œì´ ë§¤ì¶œì— ê¸°ì—¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.
        3. ê³ ê° ìˆ˜ì™€ í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ ëª¨ë‘ **ë³€ë™ì„±**ì´ ìˆì–´, ì´ë¥¼ ì•ˆì •í™”í•˜ëŠ” ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.
        
        ### ê°œì„  ì œì•ˆ:
        - **ê³ ê° ìˆ˜ ì¦ê°€ ë° ì•ˆì •í™” ì „ëµ**:
          * í”¼í¬ íƒ€ì„ê³¼ ë¹„í”¼í¬ íƒ€ì„ì˜ ê³ ê° ìˆ˜ ì°¨ì´ë¥¼ ì¤„ì´ê¸° ìœ„í•œ ì‹œê°„ëŒ€ë³„ í”„ë¡œëª¨ì…˜
          * ë©¤ë²„ì‹­ í”„ë¡œê·¸ë¨ì„ í†µí•œ ì¶©ì„± ê³ ê° í™•ë³´
          * ê·¸ë£¹ ë°©ë¬¸ê°ì„ ìœ„í•œ íŠ¹ë³„ í˜œíƒ ì œê³µ
        
        - **í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ ì¦ê°€ ì „ëµ**:
          * ë²ˆë“¤ ìƒí’ˆ ë˜ëŠ” ì„¸íŠ¸ ë©”ë‰´ êµ¬ì„±
          * ê³ ê°€ í”„ë¦¬ë¯¸ì—„ ë©”ë‰´ ë¼ì¸ì—… í™•ëŒ€
          * ì‹œì¦Œë³„ íŠ¹ë³„ ë©”ë‰´ ë„ì…
          * ì§ì› êµìœ¡ì„ í†µí•œ ì—…ì…€ë§ ëŠ¥ë ¥ í–¥ìƒ
        
        - **í†µí•© ì „ëµ**:
          * ê³ ê° ì„¸ê·¸ë¨¼íŠ¸ë³„ ë§ì¶¤í˜• ë§ˆì¼€íŒ… ì „ëµ ìˆ˜ë¦½
          * ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •ì„ ìœ„í•œ ì •ê¸°ì ì¸ ë¶„ì„ ì‹œìŠ¤í…œ êµ¬ì¶•
        """)

if __name__ == "__main__":
    main() 